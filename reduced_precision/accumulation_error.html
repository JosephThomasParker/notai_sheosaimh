
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Accumulation Error and Mixed Precision &#8212; Notai Sheosaimh</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/drawio.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=9c06fe5a" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'reduced_precision/accumulation_error';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Discretization Error" href="discretization_error.html" />
    <link rel="prev" title="Operation Costs" href="operation_costs.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/empty.png" class="logo__image only-light" alt="Notai Sheosaimh - Home"/>
    <script>document.write(`<img src="../_static/empty.png" class="logo__image only-dark" alt="Notai Sheosaimh - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Nótaí Sheosaimh
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Reduced Precision</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Representation of numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="operation_costs.html">Operation Costs</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Accumulation Error and Mixed Precision</a></li>
<li class="toctree-l1"><a class="reference internal" href="discretization_error.html">Discretization Error</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/JosephThomasParker/noti_sheosaimh" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/JosephThomasParker/noti_sheosaimh/issues/new?title=Issue%20on%20page%20%2Freduced_precision/accumulation_error.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/reduced_precision/accumulation_error.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Accumulation Error and Mixed Precision</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#representation-error">Representation Error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accumulation-error">Accumulation Error</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-precision">Double Precision</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-precision">Single Precision</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mixed-precision">Mixed Precision</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Results</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implications">Implications</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accumulation-error-versus-loop-iterations">Accumulation Error versus Loop Iterations</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="accumulation-error-and-mixed-precision">
<h1>Accumulation Error and Mixed Precision<a class="headerlink" href="#accumulation-error-and-mixed-precision" title="Link to this heading">#</a></h1>
<section id="representation-error">
<h2>Representation Error<a class="headerlink" href="#representation-error" title="Link to this heading">#</a></h2>
<p>Representation error is the error that arises from representing a number using
a finite number of binary digits.
Floating-point numbers store a number as a sign, exponent, and mantissa, which
allows exact representation of only certain values (like powers of two).
Numbers such as 1.0 are represented exactly in binary, but most decimal fractions, e.g. 0.1,
must be rounded to the nearest representable value.
The difference between the true number and its floating-point representation is
the representation error, which is typically on the order of the machine
epsilon for the given precision.
For example, in double precision, the mantissa has 53 binary bits, corresponding to around
16 decimal places of accuracy. Therefore a number like <span class="math notranslate nohighlight">\(10^{-3}\)</span> is only accurate up to <span class="math notranslate nohighlight">\(\sim 10^{-19}\)</span>,
that is, it has an error in its 16th decimal place.</p>
<p>Representation is usually negligible by itself, but becomes significant when repeated operations accumulate it,
leading to the much larger <em>accumulation error</em>.</p>
</section>
<section id="accumulation-error">
<h2>Accumulation Error<a class="headerlink" href="#accumulation-error" title="Link to this heading">#</a></h2>
<p>Accumulation error is the error that results from repeatedly rounding numbers
during numerical operations.  Floating-point arithmetic is not exact: each
operation produces a result that is rounded to the nearest representable value,
introducing an error on the order of machine epsilon, which characterizes the
relative spacing between representable numbers at a given precision.  When such
operations are performed many times in sequence, these small rounding errors
can accumulate, and can grow into the dominant error.</p>
<section id="double-precision">
<h3>Double Precision<a class="headerlink" href="#double-precision" title="Link to this heading">#</a></h3>
<p>Consider this code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># -----------------------------</span>
<span class="c1"># Parameters</span>
<span class="c1"># -----------------------------</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10_000_000</span>       <span class="c1"># number of additions</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span>             <span class="c1"># starting value</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">1e-3</span>            <span class="c1"># increment</span>

<span class="c1"># -----------------------------</span>
<span class="c1"># FP64</span>
<span class="c1"># -----------------------------</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="n">error_fp64</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">N</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FP64 final value: </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.12f</span><span class="si">}</span><span class="s2">, accumulated error: </span><span class="si">{</span><span class="n">error_fp64</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This takes the number <span class="math notranslate nohighlight">\(x_0 = 1\)</span>, and adds <span class="math notranslate nohighlight">\(dx=10^{-3}\)</span> to it 10 million times in double precision.</p>
<p>While <span class="math notranslate nohighlight">\(x_0=1\)</span> is exact in binary (<span class="math notranslate nohighlight">\(1\times 2^0\)</span>), both <span class="math notranslate nohighlight">\(dx\)</span> and the running sum <span class="math notranslate nohighlight">\(x\)</span> will have a <strong>representation error</strong>.
This error accumulates as the loop is iterated, leading to the <em>accumulation error</em>.</p>
<p>Let us consider the <span class="math notranslate nohighlight">\(k\)</span>th iteration of the loop.
In that iteration, we have the <span class="math notranslate nohighlight">\(k\)</span>th partial sum, <span class="math notranslate nohighlight">\(x_k\)</span> and the increment <span class="math notranslate nohighlight">\(dx\)</span>, both of which are only accurate up to their representation error.
That is, as stored in the computer, <span class="math notranslate nohighlight">\(x_k\)</span> and <span class="math notranslate nohighlight">\(dx\)</span> are really</p>
<div class="math notranslate nohighlight">
\[
(1+\varepsilon_{64}) x_k 
~~~~ \mathrm{and}
~~~~
(1+\varepsilon_{64}) dx  
\]</div>
<p>containing an error proportional to their size.
The error in the increment is constant, and accumulates over every iteration to give a total error</p>
<div class="math notranslate nohighlight">
\[
N\varepsilon_{64} dx
\]</div>
<p>which increases linearly with loop iterations <span class="math notranslate nohighlight">\(N\)</span>.</p>
<p>The error in the accumulated sum <span class="math notranslate nohighlight">\(x_k\)</span> depends on the value of the sum itself, and is</p>
<div class="math notranslate nohighlight">
\[
\sum_{k=1}^{N} \varepsilon_{64} x_k = 
\sum_{k=1}^{N} \varepsilon_{64} (x_0 + k\ dx) = 
\varepsilon_{64} \left(N x_0 + \frac{N(N+1)}{2}\ dx\right).
\]</div>
<p>This contains an <span class="math notranslate nohighlight">\(O(N^2)\)</span> term which dominates for a large number of iterations <span class="math notranslate nohighlight">\(N\)</span>.
Note that for small <span class="math notranslate nohighlight">\(N\)</span>, the linear term <span class="math notranslate nohighlight">\(\varepsilon_{64}N x_0\)</span> can dominate if <span class="math notranslate nohighlight">\(x_0\gg dx\)</span>.</p>
<p>Note also that while these errors are specific to a constant increment, they are representative of the behaviour of accumulation errors more generally.
In any case, the representation error <span class="math notranslate nohighlight">\(\varepsilon\)</span> is not really a constant, but rather an unknown term with that order of magnitude.
In more general algorithms, we would make estimates for order of magnitude of all terms.</p>
<section id="results">
<h4>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h4>
<p>Executing the code above, we obtain</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP64</span> <span class="n">final</span> <span class="n">value</span><span class="p">:</span> <span class="mf">10001.000001578721</span><span class="p">,</span> <span class="n">accumulated</span> <span class="n">error</span><span class="p">:</span> <span class="mf">1.579e-06</span>
</pre></div>
</div>
<p>instead of the exact result 10001.</p>
<p>Using the parameters <span class="math notranslate nohighlight">\(x_0=1\)</span>, <span class="math notranslate nohighlight">\(N=10,000,000\)</span>, <span class="math notranslate nohighlight">\(dx=0.001\)</span> and <span class="math notranslate nohighlight">\(\varepsilon_{64}=1\times 10^{-16}\)</span>, the three error terms are approximately</p>
<div class="math notranslate nohighlight">
\[\begin{split}
N\varepsilon_{64} dx = 10^8 . 10^{-16} . 10^{-3} &amp;= 10^{-11},\\
N \varepsilon_{64} x_0 &amp;= 10^{-8}\\
\varepsilon_{64} \frac{N(N+1)}{2} dx = 10^{-16} \frac{10^{16}}{2} 10^{-3} &amp;= 5\times 10^{-4}. 
\end{split}\]</div>
<p>This gives an overall estimate of <span class="math notranslate nohighlight">\(5\times10^{-4}\)</span>.
While this value is a few orders-of-magnitude too large, it is roughly correct:
the above argument assumes that all errors accumulate, while in practice the error is not of fixed sign
and there would be some degree of cancellation.</p>
</section>
</section>
<section id="single-precision">
<h3>Single Precision<a class="headerlink" href="#single-precision" title="Link to this heading">#</a></h3>
<p>Now consider performing the same operation in single precision:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -----------------------------</span>
<span class="c1"># FP32</span>
<span class="c1"># -----------------------------</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="n">error_fp32</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">N</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FP32 final value: </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.12f</span><span class="si">}</span><span class="s2">, accumulated error: </span><span class="si">{</span><span class="n">error_fp32</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The only thing that changes in the preceding argument is that the representation error is now in the 8th decimal place rather than the 16th.
The accumulation errors are</p>
<div class="math notranslate nohighlight">
\[
N\varepsilon_{32} dx
~~~~
\mathrm{and}
~~~~
\varepsilon_{32} \left(N x_0 + \frac{N(N+1)}{2}\ dx\right)
\]</div>
<p>which are exactly the same, except that are <span class="math notranslate nohighlight">\(\varepsilon_{32}/\varepsilon_{64} = 6\times 10^8\)</span> times larger.
This error is significant, and limits the usefulness of single precision in calculations.
This is why domain specialists will say that using double precision is necessary in their applications.</p>
<section id="id1">
<h4>Results<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<p>Executing the code in single precision, we obtain</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP64</span> <span class="n">final</span> <span class="n">value</span><span class="p">:</span> <span class="mf">10001.000001578721</span><span class="p">,</span> <span class="n">accumulated</span> <span class="n">error</span><span class="p">:</span> <span class="mf">1.579e-06</span>
<span class="n">FP32</span> <span class="n">final</span> <span class="n">value</span><span class="p">:</span> <span class="mf">9781.180664062500</span><span class="p">,</span> <span class="n">accumulated</span> <span class="n">error</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.198e+02</span>
</pre></div>
</div>
<p>instead of the exact result 10001.
Note that this is indeed <span class="math notranslate nohighlight">\(\sim10^8\)</span> times larger than the accumulation error in the corresponding double precision calculation.
Note also that the sign of the error is negative, and the accumulation error can accumulate in either direction.</p>
<p>Using the parameters <span class="math notranslate nohighlight">\(x_0=1\)</span>, <span class="math notranslate nohighlight">\(N=10,000,000\)</span>, <span class="math notranslate nohighlight">\(dx=0.001\)</span> and <span class="math notranslate nohighlight">\(\varepsilon_{32}=6\times 10^{-8}\)</span>, the three error terms are approximately</p>
<div class="math notranslate nohighlight">
\[\begin{split}
N\varepsilon_{32} dx = 10^8 . 6 \times 10^{-8} . 10^{-3} &amp;= 6 \times 10^{-3},\\
N \varepsilon_{32} x_0 &amp;= 6 \\
\varepsilon_{32} \frac{N(N+1)}{2} dx = 6\times 10^{-8} \frac{10^{16}}{2} 10^{-3} &amp;= 6\times 10^{5}. 
\end{split}\]</div>
<p>Again, this approximation is too large, because it does not account for errors cancelling with themselves.</p>
</section>
</section>
<section id="mixed-precision">
<h3>Mixed Precision<a class="headerlink" href="#mixed-precision" title="Link to this heading">#</a></h3>
<p>The accumulation error in single precision is more than <span class="math notranslate nohighlight">\(2\%\)</span> of the final answer, which is (usually) unacceptably high.
However, using single precision is computationally very attractive:
using FP32 halves the memory transfer costs relative to FP64,
and significantly reduces computation costs relative to FP64 – sometimes up to <span class="math notranslate nohighlight">\(\times64\)</span> faster, depending on GPU architecture.</p>
<p>The approach to retaining the benefits of single precision while keeping the accuracy of double precision is to use <em>mixed precision</em>,
that is, to compute in single precision, but accumulate the result in double precision.</p>
<p>The mixed precision code is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -----------------------------</span>
<span class="c1"># Mixed</span>
<span class="c1"># -----------------------------</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
<span class="n">error_mixed</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">N</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mixed final value: </span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.12f</span><span class="si">}</span><span class="s2">, accumulated error: </span><span class="si">{</span><span class="n">error_mixed</span><span class="si">:</span><span class="s2">.3e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This retains the computational benefits of single precision, as the <code class="docutils literal notranslate"><span class="pre">+=</span></code> operation is performed in single precision.
Similarly, the vast majority of memory loads are of <span class="math notranslate nohighlight">\(dx\)</span>, a single precision number.</p>
<p>The accumulation error calculation now changes subtly but importantly.
The error in the increment remains in single precision:</p>
<div class="math notranslate nohighlight">
\[
N\varepsilon_{32} dx
\]</div>
<p>but the error from the partial sum is at double precision</p>
<div class="math notranslate nohighlight">
\[
\sum_{k=1}^{N} \varepsilon_{64} x_k = 
\varepsilon_{64} \left(N x_0 + \frac{N(N+1)}{2}\ dx\right).
\]</div>
<p>This suggests that the dominant error will be <span class="math notranslate nohighlight">\(N\varepsilon_{32} dx\)</span>, which grows more slowly with <span class="math notranslate nohighlight">\(N\)</span> than the other errors but starts at a much higher level.</p>
<section id="id2">
<h4>Results<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP64</span> <span class="n">final</span> <span class="n">value</span><span class="p">:</span> <span class="mf">10001.000001578721</span><span class="p">,</span> <span class="n">accumulated</span> <span class="n">error</span><span class="p">:</span> <span class="mf">1.579e-06</span>
<span class="n">FP32</span> <span class="n">final</span> <span class="n">value</span><span class="p">:</span> <span class="mf">9781.180664062500</span><span class="p">,</span> <span class="n">accumulated</span> <span class="n">error</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.198e+02</span>
<span class="n">Mixed</span> <span class="n">final</span> <span class="n">value</span><span class="p">:</span> <span class="mf">10001.000474974513</span><span class="p">,</span> <span class="n">accumulated</span> <span class="n">error</span><span class="p">:</span> <span class="mf">4.750e-04</span>
</pre></div>
</div>
<p>Now the observed error is closer to the FP64 accumulation error.
Note it is correct to 8 significant figures, the precision of FP32.</p>
<p>Estimating the value of the theoretical errors, we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}
N\varepsilon_{32} dx = 10^8 . 6 \times 10^{-8} . 10^{-3} &amp;= 6 \times 10^{-3},\\
N \varepsilon_{64} x_0 &amp;= 10^{-8}\\
\varepsilon_{64} \frac{N(N+1)}{2} dx = 10^{-16} \frac{10^{16}}{2} 10^{-3} &amp;= 5\times 10^{-4},
\end{split}\]</div>
<p>which shows the linear <span class="math notranslate nohighlight">\(N\varepsilon_{32}dx\)</span> error dominates, and agrees reasonably well with the observed error.</p>
</section>
<section id="implications">
<h4>Implications<a class="headerlink" href="#implications" title="Link to this heading">#</a></h4>
<p>With mixed precision, we have suppressed the fastest growing <span class="math notranslate nohighlight">\(O(\varepsilon_{32}N^2dx)\)</span> error by accumulating in FP64.
This gives a larger, but acceptable and slower-growing error up to larger values of <span class="math notranslate nohighlight">\(N\)</span> – in effect, allowing more accumulation steps.</p>
<p>To see this, let’s compare the errors. The linear error will dominate the quadratic error, when</p>
<div class="math notranslate nohighlight">
\[
N\varepsilon_{32} dx \gtrsim
\varepsilon_{64} \frac{N(N+1)}{2} dx 
\]</div>
<p>that is, when</p>
<div class="math notranslate nohighlight">
\[
 N  
\lesssim
2 \varepsilon_{32} / \varepsilon_{64} = 1.2 \times 10^9
\]</div>
<p>So while in pure single precision, the quadratic error dominates immediately, because</p>
<div class="math notranslate nohighlight">
\[
N\varepsilon_{32} dx &lt;
\varepsilon_{32} \frac{N(N+1)}{2} dx ,
~~~~
\forall N &gt; 1,
\]</div>
<p>and the error is <span class="math notranslate nohighlight">\(\sim \varepsilon_{32} N^2 dx\)</span>,
for mixed precision, the error is smaller at <span class="math notranslate nohighlight">\(\sim \varepsilon_{32}N dx\)</span>,
which stays the dominant error for the first <span class="math notranslate nohighlight">\(2\varepsilon_{32}/\varepsilon_{64} \sim 10^9\)</span> loop iterations.</p>
</section>
</section>
<section id="accumulation-error-versus-loop-iterations">
<h3>Accumulation Error versus Loop Iterations<a class="headerlink" href="#accumulation-error-versus-loop-iterations" title="Link to this heading">#</a></h3>
<p><img alt="" src="../_images/accumulated_error.png" /></p>
<p>Here we have plotted the accumulation error again number of loop iterations of the three precisions: FP32, FP64 and mixed.</p>
<p>As expected, both FP32 and FP64 scale as number of iterations squared, <span class="math notranslate nohighlight">\(n^2\)</span>, with FP32 error larger by a factor of <span class="math notranslate nohighlight">\(\sim \varepsilon_{32}/\varepsilon_{64} \sim 10^9\)</span>.</p>
<p>For small <span class="math notranslate nohighlight">\(n\)</span>, the accumulation error for FP32 and mixed are about the same, but the mixed accumulation error grows only linearly, so is significantly smaller than the FP32 error as <span class="math notranslate nohighlight">\(n\)</span> increases.
Note that we do not reach <span class="math notranslate nohighlight">\(n \sim 10^9\)</span>, so the linear component of the mixed precision accumulation error dominates the quadratic error for the whole of the plot.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./reduced_precision"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="operation_costs.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Operation Costs</p>
      </div>
    </a>
    <a class="right-next"
       href="discretization_error.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Discretization Error</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#representation-error">Representation Error</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accumulation-error">Accumulation Error</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#double-precision">Double Precision</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-precision">Single Precision</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Results</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mixed-precision">Mixed Precision</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Results</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implications">Implications</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accumulation-error-versus-loop-iterations">Accumulation Error versus Loop Iterations</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Joseph Parker
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  Copyright@2026
</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>